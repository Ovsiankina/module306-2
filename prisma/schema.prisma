generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============== USER & AUTH ==============

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String   @default("")
  isAdmin   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  gamePlays GamePlay[]
}

// ============== SHOPS/BOUTIQUES ==============

model Shop {
  id          String   @id @default(cuid())
  name        String
  description String
  category    String
  floor       Int      @default(0)  // Floor number in the mall
  location    String   @default("") // Location description (e.g., "Near entrance A")
  websiteUrl  String   @default("") // Official website URL
  logo        String   @default("") // Logo image path
  image       String   @default("") // Shop photo
  openingHours String  @default("") // e.g., "9h-20h"
  phone       String   @default("")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  vouchers    Voucher[]
}

// ============== GAME SYSTEM ==============

model GamePlay {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  playDate    DateTime @default(now())
  attempt     Int      @default(1)  // 1 = first attempt, 2 = second attempt
  won         Boolean  @default(false)
  prizeId     String?  // Reference to the prize won (if any)
  createdAt   DateTime @default(now())
}

model DailyPrizePool {
  id          String   @id @default(cuid())
  date        DateTime @unique
  totalPrizes Int      @default(10)
  prizesWon   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Voucher {
  id          String   @id @default(cuid())
  shopId      String
  shop        Shop     @relation(fields: [shopId], references: [id], onDelete: Cascade)
  code        String   @unique
  value       Float    // Value in euros
  description String
  isUsed      Boolean  @default(false)
  wonByUserId String?  // User who won this voucher
  wonAt       DateTime?
  expiresAt   DateTime
  createdAt   DateTime @default(now())
}

// ============== PARKING ==============

model Parking {
  id            String   @id @default(cuid())
  name          String   // e.g., "Parking A", "Parking Souterrain"
  totalSpaces   Int
  availableSpaces Int
  floor         String   @default("") // e.g., "-1", "-2", "Ext√©rieur"
  isOpen        Boolean  @default(true)
  updatedAt     DateTime @updatedAt
}

// ============== VISITOR TRACKING ==============

model Visitor {
  id          String   @id @default(cuid())
  sessionId   String   @unique // Anonymous session ID
  visitDate   DateTime @default(now())
  userAgent   String   @default("")
  referrer    String   @default("")
  pageViews   Int      @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model VisitorStats {
  id          String   @id @default(cuid())
  date        DateTime @unique // Date for daily stats
  uniqueVisitors Int   @default(0)
  totalPageViews Int   @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============== MALL SETTINGS ==============

model MallInfo {
  id          String   @id @default(cuid())
  name        String   @default("Centre Commercial")
  address     String   @default("")
  phone       String   @default("")
  email       String   @default("")
  openingHours String  @default("")
  description String   @default("")
  mapImage    String   @default("") // Mall floor plan image
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============== LEGACY (kept for compatibility) ==============

model Product {
  id          String           @id @default(cuid())
  name        String
  description String
  price       Float
  category    String
  sizes       String
  image       String
  variants    ProductVariant[]
}

model ProductVariant {
  id        String  @id @default(cuid())
  priceId   String
  color     String
  images    String
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model UserOrders {
  id     String  @id @default(cuid())
  userId String  @unique
  orders Order[]
}

model Order {
  id                   String     @id @default(cuid())
  name                 String
  email                String
  phone                String?
  address              String
  products             String
  orderId              String
  purchaseDate         DateTime   @default(now())
  expectedDeliveryDate DateTime
  totalPrice           Float
  orderNumber          String
  userOrdersId         String
  userOrders           UserOrders @relation(fields: [userOrdersId], references: [id], onDelete: Cascade)
}

model Favorites {
  id        String @id @default(cuid())
  userId    String @unique
  favorites String @default("[]")
}

model Cart {
  id     String @id @default(cuid())
  userId String @unique
  items  String @default("[]")
}

model Wishlist {
  id     String @id @default(cuid())
  userId String @unique
  items  String @default("[]")
}
